<!DOCTYPE html>
<html>

<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-S2218Z2X7B"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-S2218Z2X7B');
    </script>

    <title>Calendrier Zen Flex</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/evo-calendar@1.1.3/evo-calendar/css/evo-calendar.min.css">
    <link rel="stylesheet" href="theme.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="icon" type="image/png" href="icon.png" />
</head>

<body>
    <section class="section">
        <div class="container">
            <h1 class="title">Calendrier Zen Flex</h1>
            <div id="calendar"></div>
        </div>
    </section>
    <footer class="footer">
  <div class="content has-text-centered">
    <p>
      <strong>Zen Flex Calendar</strong> by <a href="https://github.com/masfaraud">Steven Masfaraud</a>. Les données sont fournies sans garantie.
      <a href="https://github.com/masfaraud/ZenFlex">Source github</a>.
    </p>
  </div>
</footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"
        integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdn.jsdelivr.net/npm/evo-calendar@1.1.3/evo-calendar/js/evo-calendar.min.js"></script>

    <script>
        // initialize your calendar, once the page's DOM is ready
        $(document).ready(function () {
            $('#calendar').evoCalendar({
                theme: 'Midnight Blue',
                language: 'fr',
                todayHighlight: true,
                firstDayOfWeek: 1,
                eventHeaderFormat: 'D d MM yyyy'
            });

            const options = { weekday: undefined, year: 'numeric', month: 'short', day: 'numeric' };
                

            $.getJSON("https://masfaraud.github.io/ZenFlex/data.json", function (data) {

                var now = new Date();
                var tomorrow = new Date();
                tomorrow.setDate(tomorrow.getDate() + 1);
                var stop = new Date();
                stop.setDate(stop.getDate() + 365);


                function dayType(day){
                    if (day.getDay()==6 || day.getDay()==0){
                        return "eco"
                    }
                    var month = day.getMonth();
                    if (month>3 && month < 9){
                        return "eco";
                    }
                    if (month==3 && day.getDate()>15){
                        return "eco";
                    }
                    if (month==9 && day.getDate()<=15){
                        return "eco";
                    }

                    var formated_date = day.toLocaleDateString('en', options);
                    if (data['sobriete'].includes(formated_date)){
                        return "sobriete"
                    }
                    if (data['bonus'].includes(formated_date)){
                        return "bonus"
                    }

                    // If in the past, should be eco
                    if (day <= now){
                        return "eco"
                    }
                    // If day is tomorrow: before 5pm tomorrow is undecided, after it is eco
                    if (day == tomorrow && now.getHours() >= 17){
                        return "eco"
                    }
                    return "undecided"
                }


                for (var day = new Date(2023, 8, 1); day <= stop; day.setDate(day.getDate() + 1)) {
                    day_type = dayType(day)
                    var formated_date = day.toLocaleDateString('en', options);
                    if (day_type == 'sobriete') {
                        $('#calendar').evoCalendar('addCalendarEvent', {
                            id: "sobriete" + formated_date,
                            name: 'Jour Sobriété',
                            description: 'Jour sobriété Zen Flex',
                            date: formated_date,
                            type: 'event',
                            color: '#e71f1f',
                        });
                    }

                    else if (day_type == 'bonus') {
                        $('#calendar').evoCalendar('addCalendarEvent', {
                            id: "sobriete" + formated_date,
                            name: 'Jour Bonus',
                            description: 'Jour Bonus Zen Flex',
                            date: formated_date,
                            type: 'event',
                            color: '#1f4ce7',
                        });
                    }

                    else if (day_type == 'eco'){

                        $('#calendar').evoCalendar('addCalendarEvent', {
                            id: "eco" + formated_date,
                            name: 'Jour éco',
                            description: 'Jour éco',
                            date: formated_date,
                            type: 'event',
                            color: '#1fe76e',
                        });
                    }

                    else if (day_type == 'undecided'){

                        $('#calendar').evoCalendar('addCalendarEvent', {
                            id: "indef" + formated_date,
                            name: 'Jour indéfini',
                            description: 'Attendre la veille pour connaître le type de jour',
                            date: formated_date,
                            type: 'event',
                            color: '#eee',
                        });
                    }

                };


        }).fail(function () {
            console.log("An error has occurred.");
        });
    });

    </script>

</body>

</html>