<!DOCTYPE html>
<html>

<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-S2218Z2X7B"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-S2218Z2X7B');
    </script>

    <title>Calendrier Zen Flex</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/evo-calendar@1.1.3/evo-calendar/css/evo-calendar.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.9.0/css/all.min.css"
        integrity="sha512-q3eWabyZPc1XTCmF+8/LuE1ozpg5xxn7iO89yfSOd5/oKvyqLngoNGsx8jq92Y8eXJ/IRxQbEC+FGSYxtk2oiw=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="theme.css">

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">



    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
    <link rel="mask-icon" href="safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">
</head>

<body>

    <div class="container">
        <section class="section">


            <div class="tabs  is-centered">
                <ul>
                    <li class="is-active"><a>
                            <span class="icon is-small"><i class="fas fa-calendar-alt" aria-hidden="true"></i></span>
                            <span>Calendrier Zen Flex</span></a></li>
                    <li><a href="https://github.com/masfaraud/ZenFlex/blob/master/ROADMAP.md" target="_blank">
                        <span class="icon is-small"><i class="fa fa-road" aria-hidden="true"></i></span>
                        <span>A venir</span></a></li>
                    <li><a href="https://github.com/masfaraud/ZenFlex/blob/master/README.md" target="_blank">
                        <span class="icon is-small"><i class="fas fa-book" aria-hidden="true"></i></span>
                        <span>A propos</span></a>
                    <li>
                </ul>
            </div>
            <h1 class="title">Calendrier ZenFlex</h1>
            <div class="columns">
                <div class="column is-one-quarter">
                    <div class="day-card card" id="yesterday">
                        <div class="card-content">
                            <div class="media">
                                <div class="media-left">
                                    <figure class="image is-48x48">
                                        <span class="icon is-large">
                                            <i class="fas fa-2x fa-spinner fa-pulse"></i>
                                        </span>
                                    </figure>
                                </div>
                                <div class="media-content">
                                    <p class="title is-4">Hier</p>
                                    <p class="subtitle is-6 date"></p>
                                    <p class="subtitle is-6 type"></p>
                                </div>
                            </div>

                        </div>
                    </div>

                </div>
                <div class="column is-one-quarter">
                    <div class="day-card card" id="today">
                        <div class="card-content">
                            <div class="media">
                                <div class="media-left">
                                    <figure class="image is-48x48">
                                        <span class="icon is-large">
                                            <i class="fas fa-2x fa-spinner fa-pulse"></i>
                                        </span>
                                    </figure>
                                </div>
                                <div class="media-content">
                                    <p class="title is-4">Aujourd'hui</p>
                                    <p class="subtitle is-6 date"></p>
                                    <p class="subtitle is-6 type"></p>
                                </div>
                            </div>

                        </div>
                    </div>

                </div>
                <div class="column is-one-quarter">
                    <div class="day-card card" id="tomorrow">
                        <div class="card-content">
                            <div class="media">
                                <div class="media-left">
                                    <figure class="image is-48x48">
                                        <span class="icon is-large">
                                            <i class="fas fa-2x fa-spinner fa-pulse"></i>
                                        </span>
                                    </figure>
                                </div>
                                <div class="media-content">
                                    <p class="title is-4">Demain</p>
                                    <p class="subtitle is-6 date"></p>
                                    <p class="subtitle is-6 type"></p>
                                </div>
                            </div>

                        </div>
                    </div>

                </div>
                <div class="column is-one-quarter">
                    <div class="day-card card" id="after-tomorrow">
                        <div class="card-content">
                            <div class="media">
                                <div class="media-left">
                                    <figure class="image is-48x48">
                                        <span class="icon is-large">
                                            <i class="fas fa-2x fa-spinner fa-pulse"></i>
                                        </span>
                                    </figure>
                                </div>
                                <div class="media-content">
                                    <p class="title is-4">Après-demain</p>
                                    <p class="subtitle is-6 date"></p>
                                    <p class="subtitle is-6 type"></p>
                                </div>
                            </div>

                        </div>
                    </div>

                </div>

            </div>

            <div id="calendar"></div>
        </section>
    </div>
    <footer class="footer">
        <div class="content has-text-centered">
            <p>
                <strong>Calendrier Zen Flex</strong> par <a href="https://github.com/masfaraud">Steven Masfaraud</a>.
                Les
                données sont fournies sans garantie.
                <a href="https://github.com/masfaraud/ZenFlex" target="_blank">Source github</a>.
            </p>
        </div>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"
        integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdn.jsdelivr.net/npm/evo-calendar@1.1.3/evo-calendar/js/evo-calendar.min.js"></script>

    <script>
        // initialize your calendar, once the page's DOM is ready
        $(document).ready(function () {
            $('#calendar').evoCalendar({
                theme: 'Midnight Blue',
                language: 'fr',
                todayHighlight: true,
                firstDayOfWeek: 1,
                eventHeaderFormat: 'D d MM yyyy'
            });

            const format_en = { weekday: undefined, year: 'numeric', month: 'short', day: 'numeric' };
            const format_fr = { weekday: 'long', year: undefined, month: 'long', day: 'numeric' };


            $.getJSON("https://masfaraud.github.io/ZenFlex/data.json", function (data) {

                var now = new Date();
                var tomorrow = new Date();
                tomorrow.setDate(tomorrow.getDate() + 1);
                var stop = new Date();
                stop.setDate(stop.getDate() + 365);
                var yesterday = new Date();
                yesterday.setDate(yesterday.getDate() - 1);
                var after_tomorrow = new Date();
                after_tomorrow.setDate(after_tomorrow.getDate() + 2);


                function dayType(day) {
                    if (day.getDay() == 6 || day.getDay() == 0) {
                        return "eco"
                    }
                    var month = day.getMonth();
                    if (month > 3 && month < 9) {
                        return "eco";
                    }
                    if (month == 3 && day.getDate() > 15) {
                        return "eco";
                    }
                    if (month == 9 && day.getDate() <= 15) {
                        return "eco";
                    }

                    var formated_date = day.toLocaleDateString('en', format_en);
                    if (data['sobriete'].includes(formated_date)) {
                        return "sobriete"
                    }
                    if (data['bonus'].includes(formated_date)) {
                        return "bonus"
                    }

                    // If in the past, should be eco
                    if (day <= now) {
                        return "eco"
                    }
                    // If day is tomorrow: before 5pm tomorrow is undecided, after it is eco
                    if (day == tomorrow && now.getHours() >= 17) {
                        return "eco"
                    }
                    return "undecided"
                }

                const icons = { "sobriete": "fa-piggy-bank", "eco": "fa-bolt", "bonus": "fa-gift", "undecided": "fa-question" }
                const clean_types = { "sobriete": "Jour sobriété", "eco": "Jour éco", "bonus": "Jour bonus", "undecided": "Jour non défini" }
                function updateCard(card_id, day) {
                    day_type = dayType(day);
                    card = $(card_id);
                    card.addClass(day_type);
                    icon = card.find("i");
                    icon.removeClass("fa-spinner");
                    icon.removeClass("fa-pulse");
                    icon.addClass(icons[day_type]);
                    card.find("p.date").text(day.toLocaleDateString('fr', format_fr));
                    card.find("p.type").text(clean_types[day_type]);

                }

                updateCard("#yesterday", yesterday)
                updateCard("#today", now)
                updateCard("#tomorrow", tomorrow)
                updateCard("#after-tomorrow", after_tomorrow)

                for (var day = new Date(2023, 8, 1); day <= stop; day.setDate(day.getDate() + 1)) {
                    day_type = dayType(day)
                    var formated_date = day.toLocaleDateString('en', format_en);
                    if (day_type == 'sobriete') {
                        $('#calendar').evoCalendar('addCalendarEvent', {
                            id: "sobriete" + formated_date,
                            name: 'Jour Sobriété',
                            description: 'Jour sobriété Zen Flex',
                            date: formated_date,
                            type: 'event',
                            color: '#e71f1f',
                        });
                    }

                    else if (day_type == 'bonus') {
                        $('#calendar').evoCalendar('addCalendarEvent', {
                            id: "sobriete" + formated_date,
                            name: 'Jour Bonus',
                            description: 'Jour Bonus Zen Flex',
                            date: formated_date,
                            type: 'event',
                            color: '#1f4ce7',
                        });
                    }

                    else if (day_type == 'eco') {

                        $('#calendar').evoCalendar('addCalendarEvent', {
                            id: "eco" + formated_date,
                            name: 'Jour éco',
                            description: 'Jour éco',
                            date: formated_date,
                            type: 'event',
                            color: '#1fe76e',
                        });
                    }

                    else if (day_type == 'undecided') {

                        $('#calendar').evoCalendar('addCalendarEvent', {
                            id: "indef" + formated_date,
                            name: 'Jour indéfini',
                            description: 'Attendre la veille pour connaître le type de jour',
                            date: formated_date,
                            type: 'event',
                            color: '#eee',
                        });
                    }

                };


            }).fail(function () {
                console.log("An error has occurred.");
            });
        });

    </script>

</body>

</html>